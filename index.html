<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3Dæ•°æ®å¯è§†åŒ–å±•ç¤ºå¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            animation: fadeInDown 1s ease-out;
        }

        h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .chart-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: fadeInUp 1s ease-out;
            min-height: 650px;
        }

        .chart-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .chart-title {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }

        .chart-canvas {
            width: 100%;
            height: 450px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            position: relative;
            overflow: hidden;
            min-height: 450px;
        }

        .chart-canvas canvas,
        .chart-canvas .plotly,
        .chart-canvas svg,
        .chart-canvas .js-plotly-plot,
        .chart-canvas .plotly .modebar {
            max-width: 100% !important;
            max-height: 100% !important;
            width: 100% !important;
            height: 100% !important;
        }

        /* ç¡®ä¿å›¾è¡¨åœ¨å°å±å¹•ä¸Šä¹Ÿèƒ½æ­£ç¡®æ˜¾ç¤º */
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-card {
                min-height: 550px;
                padding: 15px;
            }
            
            .chart-canvas {
                height: 350px;
                min-height: 350px;
            }
            
            .chart-title {
                font-size: 1.2em;
            }
            
            .controls {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .chart-card {
                min-height: 500px;
                padding: 10px;
            }
            
            .chart-canvas {
                height: 300px;
                min-height: 300px;
            }
            
            .btn {
                font-size: 0.8em;
                padding: 6px 12px;
            }
        }

        .chart-description {
            margin-top: 15px;
            color: #666;
            line-height: 1.6;
            font-size: 0.95em;
        }

        .controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .info-panel {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            animation: fadeInUp 1s ease-out 0.2s;
            animation-fill-mode: both;
        }

        .info-title {
            font-size: 2em;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .feature {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            transition: transform 0.3s ease;
        }

        .feature:hover {
            transform: translateY(-3px);
        }

        .feature-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .feature-title {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 8px;
        }

        .feature-desc {
            color: #666;
            font-size: 0.9em;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading {
            color: #666;
            font-style: italic;
        }

        footer {
            text-align: center;
            color: white;
            margin-top: 40px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>3Dæ•°æ®å¯è§†åŒ–å±•ç¤ºå¹³å°</h1>
            <p class="subtitle">åŸºäºmatplotlibçš„3Då›¾è¡¨å¯è§†åŒ–æŠ€æœ¯å±•ç¤º</p>
        </header>

        <div class="info-panel">
            <h2 class="info-title">åŠŸèƒ½ç‰¹æ€§</h2>
            <div class="features">
                <div class="feature">
                    <div class="feature-icon">ğŸ“Š</div>
                    <div class="feature-title">3Dæ•£ç‚¹å›¾</div>
                    <div class="feature-desc">å±•ç¤ºä¸‰ç»´ç©ºé—´ä¸­æ•°æ®ç‚¹çš„åˆ†å¸ƒæƒ…å†µ</div>
                </div>
                <div class="feature">
                    <div class="feature-icon">ğŸŒŠ</div>
                    <div class="feature-title">3Dæ›²é¢å›¾</div>
                    <div class="feature-desc">å¯è§†åŒ–è¿ç»­å‡½æ•°çš„ä¸‰ç»´æ›²é¢</div>
                </div>
                <div class="feature">
                    <div class="feature-icon">ğŸ”—</div>
                    <div class="feature-title">3Dçº¿æ¡†å›¾</div>
                    <div class="feature-desc">æ˜¾ç¤ºæ•°æ®çš„ä¸‰ç»´ç½‘æ ¼ç»“æ„</div>
                </div>
                <div class="feature">
                    <div class="feature-icon">ğŸ¯</div>
                    <div class="feature-title">äº¤äº’æ§åˆ¶</div>
                    <div class="feature-desc">æ”¯æŒåŠ¨æ€æ›´æ–°å’Œå‚æ•°è°ƒæ•´</div>
                </div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <h3 class="chart-title">3Dæ•£ç‚¹å›¾ - éšæœºæ•°æ®</h3>
                <div class="chart-canvas" id="scatter1">
                    <p class="loading">æ­£åœ¨ç”Ÿæˆ3Dæ•£ç‚¹å›¾...</p>
                </div>
                <p class="chart-description">
                    å±•ç¤ºäº†30ä¸ªéšæœºæ•°æ®ç‚¹åœ¨ä¸‰ç»´ç©ºé—´ä¸­çš„åˆ†å¸ƒã€‚æ¯ä¸ªç‚¹ç”¨æ˜Ÿå½¢æ ‡è®°ï¼Œé¢œè‰²æ ¹æ®å…¶åœ¨ç©ºé—´ä¸­çš„ä½ç½®è‡ªåŠ¨åˆ†é…ï¼Œä¾¿äºè§‚å¯Ÿæ•°æ®çš„èšé›†å’Œåˆ†å¸ƒæ¨¡å¼ã€‚
                </p>
                <div class="controls">
                    <button class="btn" onclick="regenerateScatter()">é‡æ–°ç”Ÿæˆæ•°æ®</button>
                    <button class="btn" onclick="rotateScatter()">æ—‹è½¬è§†è§’</button>
                </div>
            </div>

            <div class="chart-card">
                <h3 class="chart-title">3Dæ›²é¢å›¾ - æ­£å¼¦å‡½æ•°</h3>
                <div class="chart-canvas" id="surface">
                    <p class="loading">æ­£åœ¨ç”Ÿæˆ3Dæ›²é¢å›¾...</p>
                </div>
                <p class="chart-description">
                    ä½¿ç”¨z = sin(âˆš(xÂ² + yÂ²))å‡½æ•°ç”Ÿæˆçš„ä¸‰ç»´æ›²é¢ã€‚å±•ç¤ºäº†å¦‚ä½•ç”¨é¢œè‰²æ˜ å°„è¡¨ç¤ºé«˜åº¦å˜åŒ–ï¼Œcoolwarmè‰²ç³»ä½¿é«˜ä½èµ·ä¼æ›´åŠ æ˜æ˜¾ã€‚
                </p>
                <div class="controls">
                    <button class="btn" onclick="changeColormap()">åˆ‡æ¢é¢œè‰²</button>
                    <button class="btn" onclick="changeResolution()">è°ƒæ•´åˆ†è¾¨ç‡</button>
                </div>
            </div>

            <div class="chart-card">
                <h3 class="chart-title">3Dçº¿æ¡†å›¾ - ç½‘æ ¼ç»“æ„</h3>
                <div class="chart-canvas" id="wireframe">
                    <p class="loading">æ­£åœ¨ç”Ÿæˆ3Dçº¿æ¡†å›¾...</p>
                </div>
                <p class="chart-description">
                    çº¿æ¡†å›¾æ˜¾ç¤ºäº†æ•°æ®çš„åº•å±‚ç½‘æ ¼ç»“æ„ï¼Œrstrideå’Œcstrideå‚æ•°æ§åˆ¶çº¿æ¡çš„å¯†åº¦ï¼Œå¸®åŠ©ç†è§£æ•°æ®çš„æ‹“æ‰‘ç»“æ„ã€‚
                </p>
                <div class="controls">
                    <button class="btn" onclick="changeDensity()">æ”¹å˜å¯†åº¦</button>
                    <button class="btn" onclick="toggleWireframe()">åˆ‡æ¢æ¨¡å¼</button>
                </div>
            </div>

            <div class="chart-card">
                <h3 class="chart-title">3Dæ•£ç‚¹å›¾ - åŸé•‡äººå£æ•°æ®</h3>
                <div class="chart-canvas" id="population">
                    <p class="loading">æ­£åœ¨ç”Ÿæˆäººå£åˆ†å¸ƒå›¾...</p>
                </div>
                <p class="chart-description">
                    æ¨¡æ‹Ÿ2014å¹´ç¾å›½éƒ¨åˆ†åŸé•‡çš„äººå£åˆ†å¸ƒæ•°æ®ã€‚ç‚¹çš„å¤§å°ä»£è¡¨äººå£æ•°é‡ï¼Œé¢œè‰²æ·±æµ…ä¹Ÿåæ˜ äººå£å¯†åº¦ï¼Œä¾¿äºå¿«é€Ÿè¯†åˆ«äººå£èšé›†åŒºåŸŸã€‚
                </p>
                <div class="controls">
                    <button class="btn" onclick="filterPopulation()">ç­›é€‰æ•°æ®</button>
                    <button class="btn" onclick="animatePopulation()">åŠ¨ç”»å±•ç¤º</button>
                </div>
            </div>

            <div class="chart-card">
                <h3 class="chart-title">3DæŸ±çŠ¶å›¾ - å¤šç»´æ•°æ®</h3>
                <div class="chart-canvas" id="bar3d">
                    <p class="loading">æ­£åœ¨ç”Ÿæˆ3DæŸ±çŠ¶å›¾...</p>
                </div>
                <p class="chart-description">
                    ä¸‰ç»´æŸ±çŠ¶å›¾å±•ç¤ºå¤šä¸ªç±»åˆ«çš„æ•°æ®å¯¹æ¯”ï¼Œé€šè¿‡é«˜åº¦å’Œé¢œè‰²ä¸¤ä¸ªç»´åº¦åŒæ—¶ä¼ è¾¾ä¿¡æ¯ï¼Œé€‚åˆæ¯”è¾ƒå¤æ‚çš„å¤šç»´æ•°æ®é›†ã€‚
                </p>
                <div class="controls">
                    <button class="btn" onclick="changeBarColor()">æ”¹å˜é¢œè‰²</button>
                    <button class="btn" onclick="sortBars()">æ•°æ®æ’åº</button>
                </div>
            </div>

            <div class="chart-card">
                <h3 class="chart-title">3Dç­‰é«˜çº¿å›¾</h3>
                <div class="chart-canvas" id="contour">
                    <p class="loading">æ­£åœ¨ç”Ÿæˆ3Dç­‰é«˜çº¿å›¾...</p>
                </div>
                <p class="chart-description">
                    å°†äºŒç»´ç­‰é«˜çº¿æ‰©å±•åˆ°ä¸‰ç»´ç©ºé—´ï¼ŒåŒæ—¶æ˜¾ç¤ºé«˜åº¦ä¿¡æ¯å’Œç­‰å€¼çº¿ï¼Œå¸®åŠ©ç†è§£åœ°å½¢æˆ–å‡½æ•°çš„æ¢¯åº¦å˜åŒ–ã€‚
                </p>
                <div class="controls">
                    <button class="btn" onclick="addMoreLevels()">å¢åŠ ç­‰é«˜çº¿</button>
                    <button class="btn" onclick="fillContour()">å¡«å……æ¨¡å¼</button>
                </div>
            </div>
        </div>

        <footer>
            <p>Â© 2024 3Dæ•°æ®å¯è§†åŒ–å¹³å° | åŸºäºmatplotlibå’ŒJavaScriptæŠ€æœ¯æ„å»º</p>
        </footer>
    </div>

    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let currentData = {};
        let rotationAngle = 0;

        // åˆå§‹åŒ–æ‰€æœ‰å›¾è¡¨
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                initScatterPlot();
                initSurfacePlot();
                initWireframe();
                initPopulationData();
                initBar3D();
                initContour3D();
            }, 500);
        });

        // 1. 3Dæ•£ç‚¹å›¾
        function initScatterPlot() {
            const n = 30;
            const x = Array.from({length: n}, () => Math.random() * 40);
            const y = Array.from({length: n}, () => Math.random() * 40);
            const z = Array.from({length: n}, () => Math.random() * 40);
            const colors = Array.from({length: n}, (_, i) => `hsl(${i * 12}, 70%, 50%)`);

            const trace = {
                x: x,
                y: y,
                z: z,
                mode: 'markers',
                marker: {
                    size: 12,
                    color: colors,
                    symbol: 'star',
                    line: {
                        color: 'black',
                        width: 1
                    }
                },
                type: 'scatter3d'
            };

            const layout = {
                scene: {
                    xaxis: {title: 'Xè½´', titlefont: {size: 12}},
                    yaxis: {title: 'Yè½´', titlefont: {size: 12}},
                    zaxis: {title: 'Zè½´', titlefont: {size: 12}},
                    camera: {
                        eye: {x: 1.5, y: 1.5, z: 1.5}
                    },
                    aspectmode: 'cube'
                },
                margin: {l: 20, r: 20, t: 20, b: 20},
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                autosize: true
            };

            const config = {
                responsive: true,
                displayModeBar: false,
                scrollZoom: true
            };

            currentData.scatter1 = {x, y, z, colors};
            
            document.getElementById('scatter1').innerHTML = '';
            Plotly.newPlot('scatter1', [trace], layout, config);
        }

        // 2. 3Dæ›²é¢å›¾
        function initSurfacePlot() {
            const size = 50;
            const x = [];
            const y = [];
            const z = [];

            for (let i = 0; i < size; i++) {
                x[i] = [];
                y[i] = [];
                z[i] = [];
                for (let j = 0; j < size; j++) {
                    const xVal = -5 + i * 0.2;
                    const yVal = -5 + j * 0.2;
                    x[i][j] = xVal;
                    y[i][j] = yVal;
                    const r = Math.sqrt(xVal * xVal + yVal * yVal);
                    z[i][j] = Math.sin(r);
                }
            }

            const trace = {
                x: x,
                y: y,
                z: z,
                type: 'surface',
                colorscale: 'RdYlBu',
                showscale: true
            };

            const layout = {
                scene: {
                    xaxis: {title: 'Xè½´', titlefont: {size: 12}},
                    yaxis: {title: 'Yè½´', titlefont: {size: 12}},
                    zaxis: {title: 'Zè½´', titlefont: {size: 12}, range: [-1.01, 1.01]},
                    camera: {
                        eye: {x: 1.5, y: 1.5, z: 0.8}
                    },
                    aspectmode: 'manual',
                    aspectratio: {x: 1, y: 1, z: 0.8}
                },
                margin: {l: 20, r: 20, t: 20, b: 20},
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                autosize: true
            };

            const config = {
                responsive: true,
                displayModeBar: false,
                scrollZoom: true
            };

            currentData.surface = {x, y, z};
            
            document.getElementById('surface').innerHTML = '';
            Plotly.newPlot('surface', [trace], layout, config);
        }

        // 3. 3Dçº¿æ¡†å›¾
        function initWireframe() {
            const size = 30;
            const x = [];
            const y = [];
            const z = [];

            for (let i = 0; i < size; i++) {
                x[i] = [];
                y[i] = [];
                z[i] = [];
                for (let j = 0; j < size; j++) {
                    const xVal = -3 + i * 0.2;
                    const yVal = -3 + j * 0.2;
                    x[i][j] = xVal;
                    y[i][j] = yVal;
                    z[i][j] = Math.cos(xVal) * Math.sin(yVal);
                }
            }

            const trace = {
                x: x,
                y: y,
                z: z,
                type: 'surface',
                colorscale: 'Viridis',
                showscale: false,
                hidesurface: false,
                contours: {
                    z: {
                        show: true,
                        usecolormap: true,
                        highlightcolor: "#42f462",
                        project: {z: true}
                    }
                }
            };

            const layout = {
                scene: {
                    xaxis: {title: 'Xè½´', titlefont: {size: 12}},
                    yaxis: {title: 'Yè½´', titlefont: {size: 12}},
                    zaxis: {title: 'Zè½´', titlefont: {size: 12}},
                    camera: {
                        eye: {x: 1.2, y: 1.2, z: 1.2}
                    },
                    aspectmode: 'cube'
                },
                margin: {l: 20, r: 20, t: 20, b: 20},
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                autosize: true
            };

            const config = {
                responsive: true,
                displayModeBar: false,
                scrollZoom: true
            };

            currentData.wireframe = {x, y, z};
            
            document.getElementById('wireframe').innerHTML = '';
            Plotly.newPlot('wireframe', [trace], layout, config);
        }

        // 4. äººå£æ•°æ®å¯è§†åŒ–
        function initPopulationData() {
            const cities = ['çº½çº¦', 'æ´›æ‰çŸ¶', 'èŠåŠ å“¥', 'ä¼‘æ–¯é¡¿', 'è²å°¼å…‹æ–¯', 'è´¹åŸ', 'åœ£å®‰ä¸œå°¼å¥¥', 'åœ£åœ°äºšå“¥'];
            const lat = [40.7128, 34.0522, 41.8781, 29.7604, 33.4484, 39.9526, 29.4241, 32.7157];
            const lon = [-74.0060, -118.2437, -87.6298, -95.3698, -112.0740, -75.1652, -98.4936, -117.1611];
            const pop = [8336817, 3979576, 2693976, 2320268, 1680992, 1584064, 1547253, 1423851];
            
            const size = pop.map(p => (p / Math.max(...pop)) * 50);
            const colors = pop.map(p => p / Math.max(...pop));

            const trace = {
                x: lon,
                y: lat,
                z: pop.map(p => p / 100000),
                mode: 'markers',
                marker: {
                    size: size,
                    color: colors,
                    colorscale: 'Hot',
                    showscale: true,
                    colorbar: {
                        title: 'äººå£æ¯”ä¾‹',
                        tickfont: {size: 10}
                    }
                },
                text: cities,
                type: 'scatter3d'
            };

            const layout = {
                scene: {
                    xaxis: {title: 'ç»åº¦', titlefont: {size: 12}},
                    yaxis: {title: 'çº¬åº¦', titlefont: {size: 12}},
                    zaxis: {title: 'äººå£(åä¸‡)', titlefont: {size: 12}},
                    camera: {
                        eye: {x: 1.5, y: 1.5, z: 1}
                    },
                    aspectmode: 'manual',
                    aspectratio: {x: 2, y: 1, z: 1}
                },
                margin: {l: 20, r: 20, t: 20, b: 20},
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                autosize: true
            };

            const config = {
                responsive: true,
                displayModeBar: false,
                scrollZoom: true
            };

            currentData.population = {lon, lat, pop, cities};
            
            document.getElementById('population').innerHTML = '';
            Plotly.newPlot('population', [trace], layout, config);
        }

        // 5. 3DæŸ±çŠ¶å›¾
        function initBar3D() {
            const categories = ['äº§å“A', 'äº§å“B', 'äº§å“C', 'äº§å“D', 'äº§å“E'];
            const quarters = ['Q1', 'Q2', 'Q3', 'Q4'];
            const x = [];
            const y = [];
            const z = [];
            const colors = [];

            for (let i = 0; i < categories.length; i++) {
                for (let j = 0; j < quarters.length; j++) {
                    x.push(i);
                    y.push(j);
                    z.push(Math.random() * 100 + 20);
                    colors.push(i * 0.2);
                }
            }

            const trace = {
                x: x,
                y: y,
                z: z,
                type: 'scatter3d',
                mode: 'markers',
                marker: {
                    size: z.map(val => val / 2),
                    color: colors,
                    colorscale: 'Blues',
                    symbol: 'square',
                    line: {
                        color: 'black',
                        width: 1
                    }
                },
                text: categories.map((cat, i) => 
                    quarters.map(q => `${cat} ${q}: ${z[i * quarters.length + quarters.indexOf(q)].toFixed(0)}`
                ).flat()
                ),
                type: 'scatter3d'
            };

            const layout = {
                scene: {
                    xaxis: {
                        title: 'äº§å“ç±»åˆ«',
                        titlefont: {size: 12},
                        tickvals: [0, 1, 2, 3, 4],
                        ticktext: categories,
                        tickfont: {size: 10}
                    },
                    yaxis: {
                        title: 'å­£åº¦',
                        titlefont: {size: 12},
                        tickvals: [0, 1, 2, 3],
                        ticktext: quarters,
                        tickfont: {size: 10}
                    },
                    zaxis: {title: 'é”€å”®é¢', titlefont: {size: 12}},
                    camera: {
                        eye: {x: 1.5, y: 1.5, z: 1.5}
                    },
                    aspectmode: 'manual',
                    aspectratio: {x: 2, y: 1.5, z: 1}
                },
                margin: {l: 20, r: 20, t: 20, b: 20},
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                autosize: true
            };

            const config = {
                responsive: true,
                displayModeBar: false,
                scrollZoom: true
            };

            currentData.bar3d = {x, y, z, categories, quarters};
            
            document.getElementById('bar3d').innerHTML = '';
            Plotly.newPlot('bar3d', [trace], layout, config);
        }

        // 6. 3Dç­‰é«˜çº¿å›¾
        function initContour3D() {
            const size = 40;
            const x = [];
            const y = [];
            const z = [];

            for (let i = 0; i < size; i++) {
                x[i] = [];
                y[i] = [];
                z[i] = [];
                for (let j = 0; j < size; j++) {
                    const xVal = -2 + i * 0.1;
                    const yVal = -2 + j * 0.1;
                    x[i][j] = xVal;
                    y[i][j] = yVal;
                    z[i][j] = Math.exp(-(xVal*xVal + yVal*yVal)) * Math.cos(2 * Math.PI * (xVal + yVal));
                }
            }

            const trace = {
                x: x,
                y: y,
                z: z,
                type: 'surface',
                colorscale: 'Earth',
                showscale: true,
                contours: {
                    z: {
                        show: true,
                        usecolormap: true,
                        highlightcolor: "limegreen",
                        project: {z: true}
                    }
                }
            };

            const layout = {
                scene: {
                    xaxis: {title: 'Xè½´', titlefont: {size: 12}},
                    yaxis: {title: 'Yè½´', titlefont: {size: 12}},
                    zaxis: {title: 'Zè½´', titlefont: {size: 12}},
                    camera: {
                        eye: {x: 1.3, y: 1.3, z: 1.3}
                    },
                    aspectmode: 'cube'
                },
                margin: {l: 20, r: 20, t: 20, b: 20},
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                autosize: true
            };

            const config = {
                responsive: true,
                displayModeBar: false,
                scrollZoom: true
            };

            currentData.contour = {x, y, z};
            
            document.getElementById('contour').innerHTML = '';
            Plotly.newPlot('contour', [trace], layout, config);
        }

        // æ§åˆ¶å‡½æ•°
        function regenerateScatter() {
            initScatterPlot();
        }

        function rotateScatter() {
            const update = {
                'scene.camera.eye': {
                    x: 1.5 * Math.cos(rotationAngle),
                    y: 1.5 * Math.sin(rotationAngle),
                    z: 1.5
                }
            };
            Plotly.relayout('scatter1', update);
            rotationAngle += 0.2;
        }

        function changeColormap() {
            const colorscales = ['RdYlBu', 'Viridis', 'Plasma', 'Hot', 'Cool'];
            const currentScale = colorscales[Math.floor(Math.random() * colorscales.length)];
            
            const update = {
                'marker.colorscale': currentScale
            };
            Plotly.restyle('surface', update, [0]);
        }

        function changeResolution() {
            const size = Math.floor(Math.random() * 30) + 30;
            const x = [], y = [], z = [];
            
            for (let i = 0; i < size; i++) {
                x[i] = [];
                y[i] = [];
                z[i] = [];
                for (let j = 0; j < size; j++) {
                    const xVal = -5 + i * 10 / size;
                    const yVal = -5 + j * 10 / size;
                    x[i][j] = xVal;
                    y[i][j] = yVal;
                    const r = Math.sqrt(xVal * xVal + yVal * yVal);
                    z[i][j] = Math.sin(r);
                }
            }
            
            const update = {x: [x], y: [y], z: [z]};
            Plotly.restyle('surface', update, [0]);
        }

        function changeDensity() {
            const density = Math.floor(Math.random() * 15) + 10;
            const x = [], y = [], z = [];
            
            for (let i = 0; i < density; i++) {
                x[i] = [];
                y[i] = [];
                z[i] = [];
                for (let j = 0; j < density; j++) {
                    const xVal = -3 + i * 6 / density;
                    const yVal = -3 + j * 6 / density;
                    x[i][j] = xVal;
                    y[i][j] = yVal;
                    z[i][j] = Math.cos(xVal) * Math.sin(yVal);
                }
            }
            
            const update = {x: [x], y: [y], z: [z]};
            Plotly.restyle('wireframe', update, [0]);
        }

        function toggleWireframe() {
            // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…åº”ç”¨ä¸­å¯ä»¥åœ¨surfaceå’Œwireframeæ¨¡å¼é—´åˆ‡æ¢
            initWireframe();
        }

        function filterPopulation() {
            const filtered = currentData.population.lon.map((_, i) => Math.random() > 0.3);
            const lon = currentData.population.lon.filter((_, i) => filtered[i]);
            const lat = currentData.population.lat.filter((_, i) => filtered[i]);
            const pop = currentData.population.pop.filter((_, i) => filtered[i]);
            const cities = currentData.population.cities.filter((_, i) => filtered[i]);
            
            const size = pop.map(p => (p / Math.max(...pop)) * 50);
            const colors = pop.map(p => p / Math.max(...pop));

            const trace = {
                x: lon,
                y: lat,
                z: pop.map(p => p / 100000),
                mode: 'markers',
                marker: {
                    size: size,
                    color: colors,
                    colorscale: 'Hot',
                    showscale: true
                },
                text: cities,
                type: 'scatter3d'
            };

            Plotly.restyle('population', trace, [0]);
        }

        function animatePopulation() {
            let scale = 1;
            const animate = () => {
                scale += 0.1;
                if (scale > 2) scale = 1;
                
                const update = {
                    'marker.size': currentData.population.pop.map(p => (p / Math.max(...currentData.population.pop)) * 50 * scale)
                };
                Plotly.restyle('population', update, [0]);
                
                if (scale < 2) {
                    setTimeout(animate, 200);
                }
            };
            animate();
        }

        function changeBarColor() {
            const colorscales = ['Blues', 'Reds', 'Greens', 'Viridis', 'Plasma'];
            const currentScale = colorscales[Math.floor(Math.random() * colorscales.length)];
            
            const update = {
                'marker.colorscale': currentScale
            };
            Plotly.restyle('bar3d', update, [0]);
        }

        function sortBars() {
            const {categories, quarters} = currentData.bar3d;
            const sorted = [...currentData.bar3d.z].sort((a, b) => b - a);
            const newZ = sorted.map(val => val);
            
            const update = {
                'z': [newZ]
            };
            Plotly.restyle('bar3d', update, [0]);
        }

        function addMoreLevels() {
            const update = {
                'contours.z.show': true,
                'contours.z.usecolormap': true,
                'contours.z.project.z': true
            };
            Plotly.restyle('contour', update, [0]);
        }

        function fillContour() {
            const colorscales = ['Earth', 'Viridis', 'RdYlBu', 'Hot'];
            const currentScale = colorscales[Math.floor(Math.random() * colorscales.length)];
            
            const update = {
                'colorscale': currentScale
            };
            Plotly.restyle('contour', update, [0]);
        }
    </script>
</body>
</html>